# 🚀 快速开始指南

## 前置要求

- Node.js >= 20
- pnpm (Monorepo 包管理器)
- iOS: macOS + Xcode (可选)
- Android: Android Studio + SDK (可选)
- Expo Go App (真机调试可选)

## 安装依赖

在项目根目录运行：

```bash
pnpm install
```

## 启动开发服务器

### 方式一：在 mobile 目录启动

```bash
cd packages/mobile
pnpm start
```

### 方式二：在根目录使用 filter

```bash
# 在项目根目录
pnpm --filter mobile start
```

## 在不同平台上运行

### 1. 在 iOS 模拟器中运行

```bash
pnpm --filter mobile ios
```

**要求**:
- macOS 系统
- 已安装 Xcode
- 已打开 iOS 模拟器

### 2. 在 Android 模拟器中运行

```bash
pnpm --filter mobile android
```

**要求**:
- 已安装 Android Studio
- 已配置 Android SDK
- 已创建并启动 Android 模拟器

### 3. 在浏览器中运行（Web 预览）

```bash
pnpm --filter mobile web
```

### 4. 在真机上运行

1. 安装 **Expo Go** 应用：
   - iOS: [App Store](https://apps.apple.com/app/expo-go/id982107779)
   - Android: [Google Play](https://play.google.com/store/apps/details?id=host.exp.exponent)

2. 启动开发服务器：
   ```bash
   pnpm --filter mobile start
   ```

3. 扫描终端显示的二维码
   - iOS: 使用相机扫描
   - Android: 使用 Expo Go 应用扫描

## 开发流程

### 1. 创建新页面

在 `app/` 目录创建文件即可自动生成路由：

```tsx
// app/practice/quiz.tsx
export default function QuizScreen() {
  return <View>...</View>;
}
// 自动生成路由: /practice/quiz
```

### 2. 创建组件

```tsx
// src/components/practice/QuestionCard.tsx
import { THEME } from '@constants/index';

export default function QuestionCard() {
  return <View style={{ padding: THEME.spacing.md }}>...</View>;
}
```

### 3. 调用 API

```tsx
// 使用 tRPC
import { trpc } from '@services/trpc';

export default function MyScreen() {
  const { data, isLoading } = trpc.questions.list.useQuery();
  
  // data 是类型安全的，有完整的自动提示
}
```

### 4. 使用导航

```tsx
import { useRouter } from 'expo-router';

export default function MyScreen() {
  const router = useRouter();
  
  const handlePress = () => {
    router.push('/practice/quiz');
    // 或 router.replace('/auth/login');
  };
}
```

## 常用命令

### 开发
```bash
pnpm --filter mobile start      # 启动开发服务器
pnpm --filter mobile android    # Android 模拟器
pnpm --filter mobile ios        # iOS 模拟器
pnpm --filter mobile web        # Web 浏览器
```

### 代码质量
```bash
pnpm --filter mobile typecheck  # TypeScript 类型检查
pnpm --filter mobile lint       # ESLint 检查
pnpm --filter mobile test       # 运行测试
```

### 清理缓存
```bash
# 清理 Expo 缓存
cd packages/mobile
npx expo start --clear

# 清理 Metro 缓存
npx expo start -c
```

## 项目结构速览

```
packages/mobile/
├── app/                    # 📱 路由页面 (Expo Router)
│   ├── (tabs)/            # Tab 导航
│   │   ├── index.tsx      # 首页 (/)
│   │   ├── practice.tsx   # 练习 (/practice)
│   │   ├── exams.tsx      # 考试 (/exams)
│   │   └── profile.tsx    # 我的 (/profile)
│   ├── auth/              # 认证页面
│   │   ├── login.tsx      # 登录 (/auth/login)
│   │   └── register.tsx   # 注册 (/auth/register)
│   ├── _layout.tsx        # 根布局
│   └── index.tsx          # 应用入口
│
├── src/
│   ├── components/        # 🧩 组件
│   │   └── common/        # 通用组件
│   │       └── Button.tsx
│   ├── constants/         # 📐 常量和主题
│   │   └── index.ts       # API_CONFIG, THEME
│   ├── hooks/             # 🪝 自定义 Hooks
│   │   └── useAuth.ts     # 认证 Hook
│   ├── services/          # 🔌 服务
│   │   └── trpc.ts        # tRPC 客户端
│   ├── store/             # 📦 Redux Store
│   │   ├── index.ts
│   │   └── slices/
│   │       └── authSlice.ts
│   ├── types/             # 📝 TypeScript 类型
│   │   └── index.ts
│   └── utils/             # 🛠️ 工具函数
│       ├── storage.ts     # 存储
│       ├── validators.ts  # 验证
│       └── formatters.ts  # 格式化
│
├── assets/                # 🎨 静态资源
├── app.config.js         # Expo 配置
├── package.json          # 依赖管理
└── tsconfig.json         # TypeScript 配置
```

## 环境配置

### 本地开发

默认连接本地后端服务 `http://localhost:3000`

如需修改，编辑 `app.config.js`:

```js
extra: {
  apiUrl: 'http://你的IP:3000',
  trpcUrl: 'http://你的IP:3000/trpc',
}
```

### 真机调试注意

如果在真机上调试，需要使用电脑的局域网 IP 而不是 localhost：

```js
// 例如
extra: {
  apiUrl: 'http://192.168.1.100:3000',
  trpcUrl: 'http://192.168.1.100:3000/trpc',
}
```

查看本机 IP：
- macOS: `ifconfig | grep inet`
- Windows: `ipconfig`
- Linux: `ip addr show`

## 常见问题

### 1. Metro bundler 缓存问题

```bash
# 清理缓存
npx expo start --clear
# 或
npx expo start -c
```

### 2. iOS 模拟器无法启动

```bash
# 确保 Xcode 已安装
xcode-select --install

# 打开模拟器
open -a Simulator
```

### 3. Android 模拟器连接问题

```bash
# 确保 adb 可用
adb devices

# 反向代理端口（如果需要）
adb reverse tcp:3000 tcp:3000
```

### 4. 依赖安装问题

```bash
# 清理并重新安装
rm -rf node_modules
pnpm install
```

### 5. TypeScript 报错

```bash
# 运行类型检查
pnpm typecheck

# 重启 TypeScript 服务器（VSCode）
Cmd + Shift + P -> TypeScript: Restart TS Server
```

## 调试技巧

### 1. React DevTools

```bash
# 安装 React DevTools
npm install -g react-devtools

# 启动
react-devtools
```

### 2. 控制台日志

```tsx
console.log('Debug info:', data);
console.warn('Warning message');
console.error('Error occurred');
```

在开发服务器终端可以看到日志输出。

### 3. Expo Developer Menu

在应用中：
- iOS 模拟器: `Cmd + D`
- Android 模拟器: `Cmd + M`
- 真机: 摇一摇设备

菜单选项：
- Reload: 重新加载应用
- Debug Remote JS: 使用 Chrome 调试
- Show Performance Monitor: 性能监控

## 下一步

1. ✅ 启动开发服务器
2. 📱 在模拟器或真机运行
3. 🔐 测试登录/注册功能
4. 🎨 开发新功能
5. 🧪 编写测试

## 获取帮助

- 📚 [完整文档](./README.md)
- 🔄 [迁移指南](./MIGRATION.md)
- 🌐 [Expo 官方文档](https://docs.expo.dev/)

---

祝开发愉快！🎉

